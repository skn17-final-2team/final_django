{% extends "base.html" %}
{% load static %}

{% block title %}ìƒˆ íšŒì˜{% endblock %}
{% block page_title %}ìƒˆ íšŒì˜{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/meetings/meeting_record.css' %}">
{% endblock %}

{% block content %}

<div class="record-page">

  <!-- ================= ìƒë‹¨: íšŒì˜ ì •ë³´ ì˜ì—­ ================= -->
  <header class="record-header">
    <h2 class="record-title">{{ meeting.title }}</h2>

    <div class="record-meta">
      <!-- ì¼ì •/ì¥ì†Œ ì¤„ -->
      <div class="record-meta-row">
        <img src="{% static 'img/icon-calendar.svg' %}" class="record-meta-icon-img" alt="calendar">
        <span class="record-meta-text">
          {{ meeting.meet_date_time|date:"Y.m.d H:i" }}
          Â· {{ meeting.place }}
        </span>
      </div>

      <!-- ì°¸ì„ì ì¤„ -->
      <div class="record-meta-row">
        <img src="{% static 'img/icon-person.svg' %}" class="record-meta-icon-img" alt="attendees">
        <span class="record-meta-text">
          {% for a in attendees %}
            {{ a.user.name }} ({{ a.user.dept.dept_name }})
            {% if not forloop.last %}, {% endif %}
          {% empty %}
            ì°¸ì„ìê°€ ì—†ìŠµë‹ˆë‹¤.
          {% endfor %}
        </span>
      </div>
    </div>
  </header>

  <!-- ================= ë…¹ìŒ ë° ì—…ë¡œë“œ ì˜ì—­ ================= -->
  <form id="upload-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- ë…¹ìŒ ì»¨íŠ¸ë¡¤ (ë…¹ìŒ í—ˆìš© ì—¬ë¶€ì— ë”°ë¼ í‘œì‹œ) -->
    {% if allow_recording %}
    <div class="recording-section">
      <h3 class="recording-title">ìŒì„± ë…¹ìŒ</h3>
      <div class="recording-controls">
        <button type="button" id="btn-record" class="record-btn" title="ë…¹ìŒ ì‹œì‘">
          <svg class="record-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            <line x1="12" y1="19" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
          </svg>
        </button>

        <button type="button" id="btn-pause" class="pause-btn" disabled title="ì¼ì‹œì •ì§€">
          <svg class="pause-icon" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="4" width="4" height="16" rx="1"/>
            <rect x="14" y="4" width="4" height="16" rx="1"/>
          </svg>
        </button>

        <button type="button" id="btn-stop" class="stop-btn" disabled title="ë…¹ìŒ ì¤‘ì§€">
          <svg class="stop-icon" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="6" width="12" height="12" rx="2"/>
          </svg>
        </button>

        <div class="recording-timer" id="recording-timer">00:00</div>
      </div>
      <div id="recording-status" class="recording-status"></div>
    </div>
    {% else %}
    <div class="recording-section recording-disabled">
      <h3 class="recording-title">ìŒì„± ë…¹ìŒ</h3>
      <p class="detail-empty-text">íšŒì˜ ì‹œì‘ ì‹œê°„ì´ ì˜¤ë˜ë˜ì–´ ë…¹ìŒ ê¸°ëŠ¥ì€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìŒì„± íŒŒì¼ ì—…ë¡œë“œëŠ” ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
    </div>
    {% endif %}

    <!-- íŒŒì¼ ì—…ë¡œë“œ -->
    <div class="upload-section">
      <h3 class="upload-title">íŒŒì¼ ì—…ë¡œë“œ</h3>
      <div id="dropzone" class="dropzone">
        ğŸ“‚ ì—¬ê¸°ë¡œ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì„ íƒí•˜ì„¸ìš”
        <input id="hidden-file" name="file" type="file" hidden accept=".wav"/>
        <div id="preview" class="preview"></div>
      </div>
    </div>

    <button id="upload-btn" type="button">ìŒì„± íŒŒì¼ ì—…ë¡œë“œ</button>
  </form>
{% endblock %}
{% block extra_script %}
<script src="{% static 'js/meetings/meeting_record.js' %}"></script>
{% endblock %}

